---
source: crates/compiler/parser/tests/common.rs
expression: snapshot
---
--- Code ---
fn nested_loops() {
    // Nested while loops
    let i = 0;
    while i != 5 {
        let j = 0;
        while j != 3 {
            if (i == 2 && j == 1) {
                break;
            }
            j = j + 1;
        }
        i = i + 1;
    }

    // Loop with continue
    for (let idx = 0; idx < items_len; idx = idx + 1) {
        let x = items[idx];
        if (x == 0) {
            continue;
        }
        let result = process(x);
    }

    // Infinite loop with nested control
    loop {
        let value = get_value();
        if (value == -1) {
            break;
        }
        while value != 0 {
            value = value - 1;
            if (value == 5) {
                continue;
            }
        }
    }
}

--- AST ---
[
    Function(
        Spanned(
            FunctionDef {
                name: Spanned(
                    "nested_loops",
                    3..15,
                ),
                params: [],
                return_type: Spanned(
                    Tuple(
                        [],
                    ),
                    0..0,
                ),
                body: [
                    Spanned(
                        Let {
                            pattern: Identifier(
                                Spanned(
                                    "i",
                                    54..55,
                                ),
                            ),
                            statement_type: None,
                            value: Spanned(
                                Literal(
                                    0,
                                    None,
                                ),
                                58..59,
                            ),
                        },
                        50..60,
                    ),
                    Spanned(
                        While {
                            condition: Spanned(
                                BinaryOp {
                                    op: Neq,
                                    left: Spanned(
                                        Identifier(
                                            Spanned(
                                                "i",
                                                71..72,
                                            ),
                                        ),
                                        71..72,
                                    ),
                                    right: Spanned(
                                        Literal(
                                            5,
                                            None,
                                        ),
                                        76..77,
                                    ),
                                },
                                71..77,
                            ),
                            body: Spanned(
                                Block(
                                    [
                                        Spanned(
                                            Let {
                                                pattern: Identifier(
                                                    Spanned(
                                                        "j",
                                                        92..93,
                                                    ),
                                                ),
                                                statement_type: None,
                                                value: Spanned(
                                                    Literal(
                                                        0,
                                                        None,
                                                    ),
                                                    96..97,
                                                ),
                                            },
                                            88..98,
                                        ),
                                        Spanned(
                                            While {
                                                condition: Spanned(
                                                    BinaryOp {
                                                        op: Neq,
                                                        left: Spanned(
                                                            Identifier(
                                                                Spanned(
                                                                    "j",
                                                                    113..114,
                                                                ),
                                                            ),
                                                            113..114,
                                                        ),
                                                        right: Spanned(
                                                            Literal(
                                                                3,
                                                                None,
                                                            ),
                                                            118..119,
                                                        ),
                                                    },
                                                    113..119,
                                                ),
                                                body: Spanned(
                                                    Block(
                                                        [
                                                            Spanned(
                                                                If {
                                                                    condition: Spanned(
                                                                        BinaryOp {
                                                                            op: And,
                                                                            left: Spanned(
                                                                                BinaryOp {
                                                                                    op: Eq,
                                                                                    left: Spanned(
                                                                                        Identifier(
                                                                                            Spanned(
                                                                                                "i",
                                                                                                138..139,
                                                                                            ),
                                                                                        ),
                                                                                        138..139,
                                                                                    ),
                                                                                    right: Spanned(
                                                                                        Literal(
                                                                                            2,
                                                                                            None,
                                                                                        ),
                                                                                        143..144,
                                                                                    ),
                                                                                },
                                                                                138..144,
                                                                            ),
                                                                            right: Spanned(
                                                                                BinaryOp {
                                                                                    op: Eq,
                                                                                    left: Spanned(
                                                                                        Identifier(
                                                                                            Spanned(
                                                                                                "j",
                                                                                                148..149,
                                                                                            ),
                                                                                        ),
                                                                                        148..149,
                                                                                    ),
                                                                                    right: Spanned(
                                                                                        Literal(
                                                                                            1,
                                                                                            None,
                                                                                        ),
                                                                                        153..154,
                                                                                    ),
                                                                                },
                                                                                148..154,
                                                                            ),
                                                                        },
                                                                        138..154,
                                                                    ),
                                                                    then_block: Spanned(
                                                                        Block(
                                                                            [
                                                                                Spanned(
                                                                                    Break,
                                                                                    174..180,
                                                                                ),
                                                                            ],
                                                                        ),
                                                                        156..194,
                                                                    ),
                                                                    else_block: None,
                                                                },
                                                                134..194,
                                                            ),
                                                            Spanned(
                                                                Assignment {
                                                                    lhs: Spanned(
                                                                        Identifier(
                                                                            Spanned(
                                                                                "j",
                                                                                207..208,
                                                                            ),
                                                                        ),
                                                                        207..208,
                                                                    ),
                                                                    rhs: Spanned(
                                                                        BinaryOp {
                                                                            op: Add,
                                                                            left: Spanned(
                                                                                Identifier(
                                                                                    Spanned(
                                                                                        "j",
                                                                                        211..212,
                                                                                    ),
                                                                                ),
                                                                                211..212,
                                                                            ),
                                                                            right: Spanned(
                                                                                Literal(
                                                                                    1,
                                                                                    None,
                                                                                ),
                                                                                215..216,
                                                                            ),
                                                                        },
                                                                        211..216,
                                                                    ),
                                                                },
                                                                207..217,
                                                            ),
                                                        ],
                                                    ),
                                                    120..227,
                                                ),
                                            },
                                            107..227,
                                        ),
                                        Spanned(
                                            Assignment {
                                                lhs: Spanned(
                                                    Identifier(
                                                        Spanned(
                                                            "i",
                                                            236..237,
                                                        ),
                                                    ),
                                                    236..237,
                                                ),
                                                rhs: Spanned(
                                                    BinaryOp {
                                                        op: Add,
                                                        left: Spanned(
                                                            Identifier(
                                                                Spanned(
                                                                    "i",
                                                                    240..241,
                                                                ),
                                                            ),
                                                            240..241,
                                                        ),
                                                        right: Spanned(
                                                            Literal(
                                                                1,
                                                                None,
                                                            ),
                                                            244..245,
                                                        ),
                                                    },
                                                    240..245,
                                                ),
                                            },
                                            236..246,
                                        ),
                                    ],
                                ),
                                78..252,
                            ),
                        },
                        65..252,
                    ),
                    Spanned(
                        For {
                            init: Spanned(
                                Let {
                                    pattern: Identifier(
                                        Spanned(
                                            "idx",
                                            293..296,
                                        ),
                                    ),
                                    statement_type: None,
                                    value: Spanned(
                                        Literal(
                                            0,
                                            None,
                                        ),
                                        299..300,
                                    ),
                                },
                                289..301,
                            ),
                            condition: Spanned(
                                BinaryOp {
                                    op: Less,
                                    left: Spanned(
                                        Identifier(
                                            Spanned(
                                                "idx",
                                                302..305,
                                            ),
                                        ),
                                        302..305,
                                    ),
                                    right: Spanned(
                                        Identifier(
                                            Spanned(
                                                "items_len",
                                                308..317,
                                            ),
                                        ),
                                        308..317,
                                    ),
                                },
                                302..317,
                            ),
                            step: Spanned(
                                Assignment {
                                    lhs: Spanned(
                                        Identifier(
                                            Spanned(
                                                "idx",
                                                319..322,
                                            ),
                                        ),
                                        319..322,
                                    ),
                                    rhs: Spanned(
                                        BinaryOp {
                                            op: Add,
                                            left: Spanned(
                                                Identifier(
                                                    Spanned(
                                                        "idx",
                                                        325..328,
                                                    ),
                                                ),
                                                325..328,
                                            ),
                                            right: Spanned(
                                                Literal(
                                                    1,
                                                    None,
                                                ),
                                                331..332,
                                            ),
                                        },
                                        325..332,
                                    ),
                                },
                                319..332,
                            ),
                            body: Spanned(
                                Block(
                                    [
                                        Spanned(
                                            Let {
                                                pattern: Identifier(
                                                    Spanned(
                                                        "x",
                                                        348..349,
                                                    ),
                                                ),
                                                statement_type: None,
                                                value: Spanned(
                                                    IndexAccess {
                                                        array: Spanned(
                                                            Identifier(
                                                                Spanned(
                                                                    "items",
                                                                    352..357,
                                                                ),
                                                            ),
                                                            352..357,
                                                        ),
                                                        index: Spanned(
                                                            Identifier(
                                                                Spanned(
                                                                    "idx",
                                                                    358..361,
                                                                ),
                                                            ),
                                                            358..361,
                                                        ),
                                                    },
                                                    352..361,
                                                ),
                                            },
                                            344..363,
                                        ),
                                        Spanned(
                                            If {
                                                condition: Spanned(
                                                    BinaryOp {
                                                        op: Eq,
                                                        left: Spanned(
                                                            Identifier(
                                                                Spanned(
                                                                    "x",
                                                                    376..377,
                                                                ),
                                                            ),
                                                            376..377,
                                                        ),
                                                        right: Spanned(
                                                            Literal(
                                                                0,
                                                                None,
                                                            ),
                                                            381..382,
                                                        ),
                                                    },
                                                    376..382,
                                                ),
                                                then_block: Spanned(
                                                    Block(
                                                        [
                                                            Spanned(
                                                                Continue,
                                                                398..407,
                                                            ),
                                                        ],
                                                    ),
                                                    384..417,
                                                ),
                                                else_block: None,
                                            },
                                            372..417,
                                        ),
                                        Spanned(
                                            Let {
                                                pattern: Identifier(
                                                    Spanned(
                                                        "result",
                                                        430..436,
                                                    ),
                                                ),
                                                statement_type: None,
                                                value: Spanned(
                                                    FunctionCall {
                                                        callee: Spanned(
                                                            Identifier(
                                                                Spanned(
                                                                    "process",
                                                                    439..446,
                                                                ),
                                                            ),
                                                            439..446,
                                                        ),
                                                        args: [
                                                            Spanned(
                                                                Identifier(
                                                                    Spanned(
                                                                        "x",
                                                                        447..448,
                                                                    ),
                                                                ),
                                                                447..448,
                                                            ),
                                                        ],
                                                    },
                                                    439..448,
                                                ),
                                            },
                                            426..450,
                                        ),
                                    ],
                                ),
                                334..456,
                            ),
                        },
                        284..456,
                    ),
                    Spanned(
                        Loop {
                            body: Spanned(
                                Block(
                                    [
                                        Spanned(
                                            Let {
                                                pattern: Identifier(
                                                    Spanned(
                                                        "value",
                                                        522..527,
                                                    ),
                                                ),
                                                statement_type: None,
                                                value: Spanned(
                                                    FunctionCall {
                                                        callee: Spanned(
                                                            Identifier(
                                                                Spanned(
                                                                    "get_value",
                                                                    530..539,
                                                                ),
                                                            ),
                                                            530..539,
                                                        ),
                                                        args: [],
                                                    },
                                                    530..541,
                                                ),
                                            },
                                            518..542,
                                        ),
                                        Spanned(
                                            If {
                                                condition: Spanned(
                                                    BinaryOp {
                                                        op: Eq,
                                                        left: Spanned(
                                                            Identifier(
                                                                Spanned(
                                                                    "value",
                                                                    555..560,
                                                                ),
                                                            ),
                                                            555..560,
                                                        ),
                                                        right: Spanned(
                                                            UnaryOp {
                                                                op: Neg,
                                                                expr: Spanned(
                                                                    Literal(
                                                                        1,
                                                                        None,
                                                                    ),
                                                                    565..566,
                                                                ),
                                                            },
                                                            564..566,
                                                        ),
                                                    },
                                                    555..566,
                                                ),
                                                then_block: Spanned(
                                                    Block(
                                                        [
                                                            Spanned(
                                                                Break,
                                                                582..588,
                                                            ),
                                                        ],
                                                    ),
                                                    568..598,
                                                ),
                                                else_block: None,
                                            },
                                            551..598,
                                        ),
                                        Spanned(
                                            While {
                                                condition: Spanned(
                                                    BinaryOp {
                                                        op: Neq,
                                                        left: Spanned(
                                                            Identifier(
                                                                Spanned(
                                                                    "value",
                                                                    613..618,
                                                                ),
                                                            ),
                                                            613..618,
                                                        ),
                                                        right: Spanned(
                                                            Literal(
                                                                0,
                                                                None,
                                                            ),
                                                            622..623,
                                                        ),
                                                    },
                                                    613..623,
                                                ),
                                                body: Spanned(
                                                    Block(
                                                        [
                                                            Spanned(
                                                                Assignment {
                                                                    lhs: Spanned(
                                                                        Identifier(
                                                                            Spanned(
                                                                                "value",
                                                                                638..643,
                                                                            ),
                                                                        ),
                                                                        638..643,
                                                                    ),
                                                                    rhs: Spanned(
                                                                        BinaryOp {
                                                                            op: Sub,
                                                                            left: Spanned(
                                                                                Identifier(
                                                                                    Spanned(
                                                                                        "value",
                                                                                        646..651,
                                                                                    ),
                                                                                ),
                                                                                646..651,
                                                                            ),
                                                                            right: Spanned(
                                                                                Literal(
                                                                                    1,
                                                                                    None,
                                                                                ),
                                                                                654..655,
                                                                            ),
                                                                        },
                                                                        646..655,
                                                                    ),
                                                                },
                                                                638..656,
                                                            ),
                                                            Spanned(
                                                                If {
                                                                    condition: Spanned(
                                                                        BinaryOp {
                                                                            op: Eq,
                                                                            left: Spanned(
                                                                                Identifier(
                                                                                    Spanned(
                                                                                        "value",
                                                                                        673..678,
                                                                                    ),
                                                                                ),
                                                                                673..678,
                                                                            ),
                                                                            right: Spanned(
                                                                                Literal(
                                                                                    5,
                                                                                    None,
                                                                                ),
                                                                                682..683,
                                                                            ),
                                                                        },
                                                                        673..683,
                                                                    ),
                                                                    then_block: Spanned(
                                                                        Block(
                                                                            [
                                                                                Spanned(
                                                                                    Continue,
                                                                                    703..712,
                                                                                ),
                                                                            ],
                                                                        ),
                                                                        685..726,
                                                                    ),
                                                                    else_block: None,
                                                                },
                                                                669..726,
                                                            ),
                                                        ],
                                                    ),
                                                    624..736,
                                                ),
                                            },
                                            607..736,
                                        ),
                                    ],
                                ),
                                508..742,
                            ),
                        },
                        503..742,
                    ),
                ],
            },
            0..744,
        ),
    ),
]
